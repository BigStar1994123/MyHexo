---
title: 20181017工作日誌
tags:
  - 工作
category:
  - 工作日誌
date: 2018-10-17 16:42:52
---
## 乾 Azure CosmosDb 使用 MongoDb GeoLocation功能 ##

真D好難  

首先先到Azure CosmosDb 你的Collection設定內  
將includedPaths改成  
```
  {
      "path": "/*",
      "indexes": [
          {
              "kind": "Range",
              "dataType": "Number",
              "precision": -1
          },
          {
              "kind": "Range",
              "dataType": "String",
              "precision": -1
          }
      ]
  }
```

然後再用程式碼加入2dsphere的index  
```
  IndexKeysDefinition<BravoPoint> keys = "{ Location: \"2dsphere\" }";
  var indexModel = new CreateIndexModel<BravoPoint>(keys);
  var s = collection.Indexes.CreateOne(indexModel);
```

最後可以得出Result  
```
  var gp = new GeoJsonPoint<GeoJson2DGeographicCoordinates>
      (new GeoJson2DGeographicCoordinates(121.575163, 25.078124));
  var query = Builders<BravoPoint>.Filter.Near("Location", gp, 10000);
  var result = collection.Find(query).ToList();
```

## MongoDb ##

[MongoDB 學習筆記四 C#調用MongoDB](357e58f16288c063a3c932da7a6f60f63c39c32c789a57a837d8ba4075ab1644)